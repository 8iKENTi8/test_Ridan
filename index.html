<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Выбор фигуры</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="500" height="500"></canvas><br>

  <button onclick="selectShape('triangle')">Треугольник</button>
  <button onclick="selectShape('rectangle')">Прямоугольник</button>
  <button onclick="selectShape('text')">Текст</button>
  <button onclick="deleteSelected()">Удалить выделенное</button>

  <script>
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    var selectedShape = null;
    var mouseX, mouseY, dragging = false, dragIndex;

    var shapes = [];

    function selectShape(shape) {
      selectedShape = shape;
    }

    function deleteSelected() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      selectedShape = null;
    }

    function drawShapes() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      shapes.forEach(function(shape) {
        if(shape.type === "triangle") {
          ctx.beginPath();
          ctx.moveTo(shape.x, shape.y);
          ctx.lineTo(shape.x+50, shape.y+50);
          ctx.lineTo(shape.x-50, shape.y+50);
          ctx.closePath();
          ctx.stroke();
        } else if(shape.type === "rectangle") {
          ctx.strokeRect(shape.x-25, shape.y-25, 50, 50);
        } else if(shape.type === "text") {
          ctx.font = "20px Arial";
          ctx.fillText(shape.text, shape.x, shape.y);
        }
      });
    }

    canvas.addEventListener('click', function(event) {
      if (dragging) {
        dragging = false;
        return;
      }
      
      var x = event.offsetX;
      var y = event.offsetY;
      
      if(selectedShape === 'triangle') {
        shapes.push({type: 'triangle', x: x, y: y});
        drawShapes();
      } else if(selectedShape === 'rectangle') {
        shapes.push({type: 'rectangle', x: x, y: y});
        drawShapes();
      } else if(selectedShape === 'text') {
        var text = prompt("Введите текст:");
        if(text !== null && text !== "") {
          shapes.push({type: 'text', x: x, y: y, text: text});
          drawShapes();
        }
      }
    });

    canvas.addEventListener('mousedown', function(event) {
      mouseX = event.offsetX;
      mouseY = event.offsetY;
      
      shapes.forEach(function(shape, index) {
        var dx = shape.x - mouseX;
        var dy = shape.y - mouseY;

        if(shape.type === 'triangle' || shape.type === 'rectangle') {
          if (dx * dx + dy * dy < 50 * 50) {
            dragging = true;
            dragIndex = index;
          }
        } else if (shape.type === 'text') {
          var textWidth = ctx.measureText(shape.text).width;
          if (dx >= 0 && dx <= textWidth && dy >= -20 && dy <= 0) {
            dragging = true;
            dragIndex = index;
          }
        }
      });
    });

    canvas.addEventListener('mousemove', function(event) {
      if (!dragging) {
        return;
      }
      
      var newX = event.offsetX;
      var newY = event.offsetY;
      
      var dx = newX - mouseX;
      var dy = newY - mouseY;
      
      shapes[dragIndex].x += dx;
      shapes[dragIndex].y += dy;
      drawShapes();

      mouseX = newX;
      mouseY = newY;
    });

    canvas.addEventListener('mouseup', function(event) {
      dragging = false;
    });
  </script>
</body>
</html>