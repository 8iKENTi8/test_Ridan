<!DOCTYPE html>
<html>
<head>
    <style>
        /* Стили для контейнера */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            position: relative;
            width: 600px;
            height: 400px;
            border: 1px solid #ccc;
        }

        /* Стили для фигур */
        .shape {
            position: absolute;
            cursor: pointer;
        }

        .triangle {
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 52px solid #007bff;
        }

        .rectangle {
            width: 100px;
            height: 50px;
            background-color: #ff5722;
        }

        /* Стили для линий */
        .line {
            position: absolute;
            border: 1px solid #000;
            pointer-events: none;
        }

        /* Стили для надписей */
        .label {
            position: absolute;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container" id="drawingArea">
        <!-- Здесь будут отображаться фигуры, линии и надписи -->
    </div>

    <svg id="svgContainer" width="600" height="400">
        <!-- Здесь будут отображаться линии -->
    </svg>

    <div>
        <label for="shapeSelector">Выберите фигуру:</label>
        <select id="shapeSelector">
            <option value="triangle">Треугольник</option>
            <option value="rectangle">Прямоугольник</option>
        </select>
        <button id="connectButton">Соединить</button>
        <input type="text" id="labelText" placeholder="Введите текст">
        <button id="addLabelButton">Добавить надпись</button>
    </div>

    <script>
        const drawingArea = document.getElementById("drawingArea");
        const shapeSelector = document.getElementById("shapeSelector");
        const connectButton = document.getElementById("connectButton");
        const labelText = document.getElementById("labelText");
        const addLabelButton = document.getElementById("addLabelButton");
        const svgContainer = document.getElementById("svgContainer");

        let selectedShape = null;
        let startPoint = null;
        let connectingLine = null;

        function createShape(event) {
            const shapeType = shapeSelector.value;
            const target = event.target;

            // Проверяем, что клик произошел внутри области рисования и по пустому пространству
            if (target.id === "drawingArea") {
                const shape = document.createElement("div");
                shape.className = `shape ${shapeType}`;
                shape.style.left = event.pageX - drawingArea.offsetLeft + "px";
                shape.style.top = event.pageY - drawingArea.offsetTop + "px";

                shape.addEventListener("mousedown", startDragging);
                drawingArea.appendChild(shape);
            }
        }

        function startDragging(event) {
            selectedShape = event.target;
            startPoint = { x: event.clientX, y: event.clientY };

            document.addEventListener("mousemove", dragShape);
            document.addEventListener("mouseup", stopDragging);
        }

        function dragShape(event) {
            const offsetX = event.clientX - startPoint.x;
            const offsetY = event.clientY - startPoint.y;

            selectedShape.style.left = selectedShape.offsetLeft + offsetX + "px";
            selectedShape.style.top = selectedShape.offsetTop + offsetY + "px";

            startPoint = { x: event.clientX, y: event.clientY };
        }

        function stopDragging() {
            selectedShape = null;
            startPoint = null;

            document.removeEventListener("mousemove", dragShape);
            document.removeEventListener("mouseup", stopDragging);
        }

        function connectShapes() {
            if (selectedShape) {
                if (!connectingLine) {
                    connectingLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    connectingLine.setAttribute("stroke", "black");
                    connectingLine.setAttribute("stroke-width", "2");
                    connectingLine.setAttribute("x1", selectedShape.offsetLeft + selectedShape.offsetWidth / 2);
                    connectingLine.setAttribute("y1", selectedShape.offsetTop + selectedShape.offsetHeight / 2);
                    connectingLine.setAttribute("x2", selectedShape.offsetLeft + selectedShape.offsetWidth / 2);
                    connectingLine.setAttribute("y2", selectedShape.offsetTop + selectedShape.offsetHeight / 2);
                    svgContainer.appendChild(connectingLine);
                } else {
                    connectingLine = null;
                }
            }
        }

        function addLabel() {
            if (selectedShape && labelText.value.trim() !== "") {
                const label = document.createElement("div");
                label.className = "label";
                label.innerText = labelText.value;
                label.style.left = selectedShape.offsetLeft + "px";
                label.style.top = selectedShape.offsetTop - 20 + "px";

                drawingArea.appendChild(label);
            }
        }

        connectButton.addEventListener("click", connectShapes);
        addLabelButton.addEventListener("click", addLabel);
        drawingArea.addEventListener("click", createShape);
    </script>
</body>
</html>
